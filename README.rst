|PyPI version| |License: MIT| |Downloads|

zoomg Docs
==========

バーチャル背景適用済み動画からバーチャル背景を復元するライブラリ

.. figure:: https://github.com/Tsuku43/zoomg/blob/master/images/icon.png?raw=true
   :alt: icon

   icon

System Requirements / 動作保証環境
----------------------------------

-  python 3.6.4
-  pip 20.2.4
-  OS

   -  macOS Catalina 10.15.7 (x86_64)
   -  macOS Bug Sur 11.4 (aarch64)
   -  Ubuntu 20.04.1 LTS / 18.04.4 LTS

Installing / インストール
-------------------------

-  aarch64環境の場合

.. code:: shell

   pip install zoomg

-  x86_64環境の場合

.. code:: shell

   pip install git+https://github.com/Tsuku43/zoomg

**Windows では動作保証をしていません**

How to use / 使用方法
---------------------

簡単な使用方法
~~~~~~~~~~~~~~

.. code:: sh

   python3 sample.py sample_video.mp4

.. code:: python

   import zoomg
   import cv2
   import sys
   import numpy


   # ビデオ読み込みの初期設定
   filename = sys.argv[1]
   video = cv2.VideoCapture(filename)
   height = int(video.get(cv2.CAP_PROP_FRAME_HEIGHT))
   width = int(video.get(cv2.CAP_PROP_FRAME_WIDTH))

   # zoomgの初期化
   zoom = zoomg.Zoomg(height, width)

   while True:
       # フレーム読み込み
       ret, frame = video.read()
       if not ret:
           break
       # zoomgに画像を追加
       zoom.add_image(frame)

   # 背景画像を生成
   zoom.generate_image()
   # 背景画像を取得
   image = zoom.get_image()
   # 背景画像を保存
   cv2.imwrite("room.png", numpy.array(image))

Zoomg クラス
~~~~~~~~~~~~

背景画像の生成を行います.

**コンストラクタ**
^^^^^^^^^^^^^^^^^^

.. code:: python

   zoom = zoomg.Zoomg(height, width)

-  引数

========== === ============== ==== ==============
パラメータ 型  キーワード引数 省略 説明
========== === ============== ==== ==============
height     int 可(h)          -    入力画像の高さ
width      int 可(w)          -    入力画像の幅
========== === ============== ==== ==============

-  返り値

========== ===== ==================
パラメータ 型    説明
========== ===== ==================
zoom       Zoomg Zoomg オブジェクト
========== ===== ==================

--------------

**Zoomg.add_image**
^^^^^^^^^^^^^^^^^^^

zoomg
オブジェクトに画像を追加します.動画を入力したい場合はフレーム単位で分割する必要があります.

.. code:: python

   zoom.add_image(frame)

-  引数

+------------+---------------+---------------+------+---------------+
| パラメータ | 型            | キ            | 省略 | 説明          |
|            |               | ーワード引数  |      |               |
+============+===============+===============+======+===============+
| frame      | 3 次元        | -             | -    | zoomg         |
|            | numpy.ndarray |               |      | オ            |
|            |               |               |      | ブジェクトに  |
|            |               |               |      | 追加する画像  |
+------------+---------------+---------------+------+---------------+

-  返り値

   -  なし

--------------

**Zoomg.generate_image**
^^^^^^^^^^^^^^^^^^^^^^^^

``Zoomg.add_image``\ で追加した画像から背景画像を復元する.

.. code:: python

   zoom.generate_image(comp, param, noise_frame)

-  引数

+---+---+-----+--------------+-----------------------------------------+
| パ | 型 | キ | 省略        | 説明                                    |
| ラ |  | ー  |              |                                         |
| メ |  | ワ  |              |                                         |
| ー |  | ー  |              |                                         |
| タ |  | ド  |              |                                         |
|   |   | 引  |              |                                         |
|   |   | 数  |              |                                         |
+===+===+=====+==============+=========================================+
| c | s | 可  | 可(default=  | 色差を決定する．詳                      |
| o | t | (co | “ciede2000”) | 細は表「\ `色差 <#色差>`__\ 」を参照．  |
| m | r | mp) |              |                                         |
| p | i |     |              |                                         |
|   | n |     |              |                                         |
|   | g |     |              |                                         |
+---+---+-----+--------------+-----------------------------------------+
| p | f | 可( | 可(defau     | 各ピクセルが部屋の背景かバーチ          |
| a | l | par | lt=表「\ `色 | ャル背景か判定するためのパラメータ．詳  |
| r | o | am) | 差 <#色差>`_ | 細は表「\ `色差 <#色差>`__\ 」を参照．  |
| a | a |     | _\ 」を参照) |                                         |
| m | t |     |              |                                         |
+---+---+-----+--------------+-----------------------------------------+
| n | i | 可( | 可           | 画像にノイズが多く含まれてい            |
| o | n | noi | (default=1)  | る場合,ノイズを軽減するためのパラメータ |
| i | t | se_ |              |                                         |
| s |   | fra |              |                                         |
| e |   | me) |              |                                         |
| _ |   |     |              |                                         |
| f |   |     |              |                                         |
| r |   |     |              |                                         |
| a |   |     |              |                                         |
| m |   |     |              |                                         |
| e |   |     |              |                                         |
+---+---+-----+--------------+-----------------------------------------+

色差
''''

+---------+----+--------+-------+------------------------------------+
| 色      | co | param  | 省略  | 説明                               |
| 差計算  | mp | 指定可 |       |                                    |
| アルゴ  |    | 能範囲 |       |                                    |
| リズム  |    |        |       |                                    |
+=========+====+========+=======+====================================+
| コ      | `  | [0.0,  | 可    | 高くす                             |
| サイン  | `c | 1.0]   | (def  | ると復元できるピクセル数が\ **減り |
| 類似度  | os |        | ault= | **,低くすると誤判定が\ **増える**. |
|         | _s |        | 0.75) |                                    |
|         | im |        |       |                                    |
|         | `` |        |       |                                    |
+---------+----+--------+-------+------------------------------------+
| CI      | `  | [0.0,  | 可    | 高くす                             |
| EDE2000 | `c | 100]   | (def  | ると誤判定が\ **増え**,低くすると  |
|         | ie |        | ault= | 復元できるピクセル数が\ **減る**.  |
|         | de |        | 5.06) |                                    |
|         | 20 |        |       |                                    |
|         | 00 |        |       |                                    |
|         | `` |        |       |                                    |
+---------+----+--------+-------+------------------------------------+

-  返り値

   -  なし

--------------

**Zoomg.get_image**
^^^^^^^^^^^^^^^^^^^

``Zoomg.generate_image``\ で生成した画像を取得します.

.. code:: python

   image = zoom.get_image()

-  引数

   -  なし

-  返り値

========== ================== ====================
パラメータ 型                 説明
========== ================== ====================
image      int 型 3 次元 list 復元した画像ファイル
========== ================== ====================

--------------

**Zoomg.get_omgc**
^^^^^^^^^^^^^^^^^^

``Zoomg.generate_image``\ を使用した際,正しく復元できたか拘らず,復元したピクセル数を返します.この数は\ ``Zoomg.generate_image``\ の引数\ ``param``\ に影響されます.

.. code:: python

   omgc = zoom.get_omgc()

-  引数

   -  なし

-  返り値

========== === ==================
パラメータ 型  説明
========== === ==================
omgc       int 復元したピクセル数
========== === ==================

--------------

**Zoomg.verify**
^^^^^^^^^^^^^^^^

``Zoomg.generate_image``\ の\ ``param``\ 引数の値がどれだけいいものか検証します.部屋の画像と復元した部屋の画像からどれだけ二つの画像が似ているか計測し,復元精度を返します.

.. code:: python

   ok, ng, acc = zoomg.verify(room_image, comp, param)

-  引数

+---+-------+----+-------------+--------------------------------------+
| パ | 型   | キ | 省略        | 説明                                 |
| ラ |      | ー |             |                                      |
| メ |      | ワ |             |                                      |
| ー |      | ー |             |                                      |
| タ |      | ド |             |                                      |
|   |       | 引 |             |                                      |
|   |       | 数 |             |                                      |
+===+=======+====+=============+======================================+
| r | 3     | -  | -           | 部屋の画像                           |
| o | 次元  |    |             |                                      |
| o | num   |    |             |                                      |
| m | py.nd |    |             |                                      |
| _ | array |    |             |                                      |
| i |       |    |             |                                      |
| m |       |    |             |                                      |
| a |       |    |             |                                      |
| g |       |    |             |                                      |
| e |       |    |             |                                      |
+---+-------+----+-------------+--------------------------------------+
| c | s     | 可 | 可          | 色差を決定する．詳細                 |
| o | tring | (c | (default=“  | は表「\ `色差 <#色差>`__\ 」を参照． |
| m |       | om | ciede2000”) |                                      |
| p |       | p) |             |                                      |
+---+-------+----+-------------+--------------------------------------+
| p | float | 可 | 可(default= | 各ピクセルが部屋の背景かバーチャル   |
| a |       | (  | 表「\ `色差 | 背景か判定するためのパラメータ．詳細 |
| r |       | pa |  <#色差>`__ | は表「\ `色差 <#色差>`__\ 」を参照． |
| a |       | ra | \ 」を参照) |                                      |
| m |       | m) |             |                                      |
+---+-------+----+-------------+--------------------------------------+

-  返り値

========== ===== ======================================
パラメータ 型    説明
========== ===== ======================================
ok         int   部屋の画像と復元画像のピクセル一致数
ng         int   部屋の画像と復元画像のピクセル不一致数
acc        float 精度(``ok / (ok + ng)``)
========== ===== ======================================

--------------

**Zoomg.get_height**
^^^^^^^^^^^^^^^^^^^^

生成画像の高さを取得します.\ ``zoomg.Zoomg(height, width)``\ の\ ``height``\ と同一の値になります.

.. code:: python

   height = zoomg.get_height()

-  引数

   -  なし

-  返り値

========== === ==============
パラメータ 型  説明
========== === ==============
height     int 生成画像の高さ
========== === ==============

--------------

**Zoomg.get_width**
^^^^^^^^^^^^^^^^^^^

生成画像の幅を取得します.\ ``zoomg.Zoomg(height, width)``\ の\ ``width``\ と同一の値になります.

.. code:: python

   width = zoomg.get_width()

-  引数

   -  なし

-  返り値

========== === ============
パラメータ 型  説明
========== === ============
width      int 生成画像の幅
========== === ============

--------------

**Zoomg.get_shape**
^^^^^^^^^^^^^^^^^^^

生成画像の高さと幅を取得します.\ ``zoomg.Zoomg(height, width)``\ の\ ``height``\ と同一の値になります.

.. code:: python

   height, width = zoomg.get_shape()

-  引数

   -  なし

-  返り値

========== === ==============
パラメータ 型  説明
========== === ==============
height     int 生成画像の高さ
width      int 生成画像の幅
========== === ==============

--------------

Function
~~~~~~~~

その他,利用できる関数をこちらに記載します.

**add_noise()**
^^^^^^^^^^^^^^^

背景画像の生成を妨害します.画像に対してノイズを入ります.

.. code:: python

   zoomg.get_shape(image&, height, width, rate)

-  引数

+------------+-------------+-------------+-------------+-------------+
| パラメータ | 型          | キー        | 省略        | 説明        |
|            |             | ワード引数  |             |             |
+============+=============+=============+=============+=============+
| image      | 3 次元      | -           | -           | ノイズを入  |
|            | nu          |             |             | れたい画像  |
|            | mpy.ndarray |             |             |             |
|            | の参照      |             |             |             |
+------------+-------------+-------------+-------------+-------------+
| height     | int         | 可(h)       | -           | ``imag      |
|            |             |             |             | e``\ の高さ |
+------------+-------------+-------------+-------------+-------------+
| width      | int         | 可(w)       | -           | ``im        |
|            |             |             |             | age``\ の幅 |
+------------+-------------+-------------+-------------+-------------+
| rate       | float       | 可(rate)    | 可(defa     | ノイズの    |
|            |             |             | ult=0.0003) | 入れる割合  |
+------------+-------------+-------------+-------------+-------------+

-  返り値

========== === ==============
パラメータ 型  説明
========== === ==============
height     int 生成画像の高さ
width      int 生成画像の幅
========== === ==============

--------------

Build / ビルド
--------------

-  本ソースコードのコンパイル

.. code:: sh

   > pwd
   ほにゃらら/zoomg/zoomg

   > clang++ -O3 -Wall -shared -std=c++17 -fPIC `python -m pybind11 --includes` -undefined dynamic_lookup zoomg.cpp ColorSpace/src/Comparison.cpp ColorSpace/src/ColorSpace.cpp ColorSpace/src/Conversion.cpp -o zoomg`python3-config --extension-suffix`

-  実行

.. code:: sh

   > cd test
   > pip uninstall zoomg # いらないかも
   > python test.py sample_02.mp4

.. |PyPI version| image:: https://badge.fury.io/py/zoomg.svg
   :target: https://badge.fury.io/py/zoomg
.. |License: MIT| image:: https://img.shields.io/badge/License-MIT-yellow.svg
   :target: https://opensource.org/licenses/MIT
.. |Downloads| image:: https://pepy.tech/badge/zoomg
   :target: https://pepy.tech/project/zoomg
